{% extends 'base.html' %}
{% load static %}
{% block title %}Home{% endblock title %}
{% load crispy_forms_tags %}


{% block main-content %}

<div class="container mt-2 mb-5">
  <div class="row justify-content-center">
    <div class="col-md-6 col-lg-5">
      <div class="card shadow border-0 p-4">
        <h3 class="text-center mb-4">ðŸŒ¾ Farm Input Form</h3>
        <hr class="gradient-double">

        <!-- Progress Bar -->
        <div class="progress mb-4">
          <div id="progress-bar" class="progress-bar bg-success" style="width: 50%;">
            Step 1 of 2
          </div>
        </div>

        <form method="POST" id="farmForm" enctype="multipart/form-data">
          {% csrf_token %}

          {% if messages %}
            {% for msg in messages %}
              <div class="alert alert-{{ msg.tags }}" role="alert">
                {{ msg }}
              </div>
            {% endfor %}
          {% endif %}

          <!-- Step 1 -->
          <div class="form-step" id="step1">
            <h5 class="mb-3 text-success">ðŸŒ± Basic Farm Inputs</h5>
            {{ form|crispy }}
            <div class="d-flex justify-content-end mt-4">
              <button type="button" class="btn btn-success" id="nextBtn">Next âž¡</button>
            </div>
          </div>

          <!-- Step 2 -->
          <div class="form-step d-none" id="step2">
            <h5 class="mb-3 text-success">ðŸ§ª Additional Inputs</h5>
            {{ formtwo|crispy }}
            <div class="d-flex justify-content-between mt-4">
              <button type="button" class="btn btn-secondary" id="backBtn">â¬… Back</button>
              <button type="submit" class="btn btn-success">âœ… Submit</button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
  const step1 = document.getElementById("step1");
  const step2 = document.getElementById("step2");
  const nextBtn = document.getElementById("nextBtn");
  const backBtn = document.getElementById("backBtn");
  const progressBar = document.getElementById("progress-bar");

  nextBtn.addEventListener("click", () => {
    step1.classList.add("d-none");
    step2.classList.remove("d-none");
    progressBar.style.width = "100%";
    progressBar.innerText = "Step 2 of 2";
  });

  backBtn.addEventListener("click", () => {
    step2.classList.add("d-none");
    step1.classList.remove("d-none");
    progressBar.style.width = "50%";
    progressBar.innerText = "Step 1 of 2";
  });

  //Hide and show nursery and permanent stage
  document.addEventListener('DOMContentLoaded', function() {
  const stageSelect = document.getElementById('id_plant_stage');
  const plantNumberDiv = document.getElementById('div_id_plant_number');
  const plantAgeDiv = document.getElementById('div_id_plant_age');
  const cocopeatNameDiv = document.getElementById('div_id_cocopeat_name');
  const cocopeatWeightDiv = document.getElementById('div_id_cocopeat_weight');

  // Function to toggle visibility
  function toggleFields() {
    const stageValue = stageSelect.value;

    if (stageValue === '1') { // Nursery selected
      plantNumberDiv.style.display = 'none';
      plantAgeDiv.style.display = 'none';
      cocopeatNameDiv.style.display = 'block';
      cocopeatWeightDiv.style.display = 'block';
    } else {
      plantNumberDiv.style.display = 'block';
      plantAgeDiv.style.display = 'block';
      cocopeatNameDiv.style.display = 'none';
      cocopeatWeightDiv.style.display = 'none';
    }
  }

  // Run on page load
  toggleFields();

  // Run when dropdown changes
  stageSelect.addEventListener('change', toggleFields);

//To hide and show other seed varieties
  const seedSelect = document.getElementById("id_seed_variety");
    const otherInput = document.getElementById("id_seed_variety_other");

    if (!seedSelect || !otherInput) return;

    // Find crispy wrapper (usually .form-group or .mb-3)
    const otherWrapper = otherInput.closest(".mb-3, .form-group");

    function toggleOtherField() {
        if (seedSelect.value === "OT") {
            otherWrapper.style.display = "block";
        } else {
            otherWrapper.style.display = "none";
            otherInput.value = "";
        }
    }

    // Run on load (important for edit forms)
    toggleOtherField();

    // Run when selection changes
    seedSelect.addEventListener("change", toggleOtherField);

});



</script>


<br/><br/>
{% endblock main-content %}

